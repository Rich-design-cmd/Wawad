<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thread - Wirecars Forum</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="font-sans text-gray-900 bg-gray-50">
    <!-- Navigation -->
    <nav class="fixed w-full z-50 bg-gray-900 shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <a href="index.html" class="text-white text-2xl font-bold flex items-center">
                        <i class="fas fa-car mr-2"></i>
                        Wirecars
                    </a>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="index.html" class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">History</a>
                        <a href="cars.html" class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Cars</a>
                        <a href="events.html" class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Events</a>
                        <a href="garage.html" class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Garage</a>
                        <a href="forum.html" class="bg-gray-700 text-white px-3 py-2 rounded-md text-sm font-medium">Forum</a>
                        <a href="contact.html" class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Contact</a>
                    </div>
                </div>
                <div class="md:hidden">
                    <button id="mobile-menu-button" class="text-gray-300 hover:text-white">
                        <i class="fas fa-bars text-2xl"></i>
                    </button>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden bg-gray-800">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="index.html" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">History</a>
                <a href="cars.html" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Cars</a>
                <a href="events.html" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Events</a>
                <a href="garage.html" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Garage</a>
                <a href="forum.html" class="bg-gray-700 text-white block px-3 py-2 rounded-md text-base font-medium">Forum</a>
                <a href="contact.html" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Contact</a>
            </div>
        </div>
    </nav>

    <!-- Back Button -->
    <section class="pt-24 pb-4 bg-white">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <a href="forum.html" class="inline-flex items-center text-purple-600 hover:text-purple-800 font-medium">
                <i class="fas fa-arrow-left mr-2"></i>
                Back to Forum
            </a>
        </div>
    </section>

    <!-- Thread Content -->
    <section class="py-8 bg-gray-50">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            
            <!-- Thread Header -->
            <div id="thread-header" class="bg-white rounded-lg shadow-lg p-8 mb-6">
                <!-- Loaded dynamically -->
                <div class="text-center py-12">
                    <i class="fas fa-spinner fa-spin text-4xl text-purple-600 mb-4"></i>
                    <p class="text-gray-600">Loading discussion...</p>
                </div>
            </div>

            <!-- Posts -->
            <div id="posts-list" class="space-y-6">
                <!-- Posts loaded dynamically -->
            </div>

            <!-- Reply Form -->
            <div class="bg-white rounded-lg shadow-lg p-8 mt-8">
                <h3 class="text-2xl font-bold text-gray-900 mb-6">Reply to this Discussion</h3>
                <form id="reply-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Your Name</label>
                        <input type="text" id="reply-username" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Your Reply</label>
                        <textarea id="reply-content" rows="6" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"></textarea>
                    </div>
                    <button type="submit" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-8 rounded-lg transition duration-300 transform hover:-translate-y-1">
                        Post Reply
                    </button>
                </form>
                <div id="reply-message" class="mt-4"></div>
            </div>

        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-12 mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h3 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-car mr-2"></i>
                        Wirecars
                    </h3>
                    <p class="text-gray-400">Celebrating the art and culture of handmade wirecars worldwide.</p>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-4">Quick Links</h3>
                    <ul class="space-y-2">
                        <li><a href="cars.html" class="text-gray-400 hover:text-white transition-colors">Cars Gallery</a></li>
                        <li><a href="events.html" class="text-gray-400 hover:text-white transition-colors">Events</a></li>
                        <li><a href="garage.html" class="text-gray-400 hover:text-white transition-colors">Garage Wiki</a></li>
                        <li><a href="forum.html" class="text-gray-400 hover:text-white transition-colors">Forum</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-4">Follow Us</h3>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-blue-500 text-2xl transition-colors"><i class="fab fa-facebook"></i></a>
                        <a href="#" class="text-gray-400 hover:text-pink-500 text-2xl transition-colors"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="text-gray-400 hover:text-blue-700 text-2xl transition-colors"><i class="fab fa-linkedin"></i></a>
                    </div>
                    <p class="text-gray-400 mt-4">
                        <i class="fas fa-envelope mr-2"></i>
                        Email: johnson@wirecars.org
                    </p>
                </div>
            </div>
            <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400">
                <p>&copy; 2026 Wirecars. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script type="module" src="scripts/main.js"></script>
    <script type="module">
        import { forumAPI } from './scripts/api.js';

        const urlParams = new URLSearchParams(window.location.search);
        const threadId = urlParams.get('id');

        if (!threadId) {
            window.location.href = 'forum.html';
        }

        const categoryBadges = {
            'car-talk': 'bg-blue-100 text-blue-800',
            'wip': 'bg-orange-100 text-orange-800',
            'general': 'bg-gray-100 text-gray-800'
        };

        // Mock data for demo
        const mockThread = {
            id: threadId,
            title: threadId === '1' ? 'Help with steering mechanism' : 'Showcase: My 1950s Classic Collection',
            user_name: threadId === '1' ? 'Marcus J.' : 'Alicia T.',
            category: threadId === '1' ? 'wip' : 'car-talk',
            created_at: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),
            content: threadId === '1' 
                ? 'I\'m working on a new wire car and having trouble with the steering mechanism. It doesn\'t turn smoothly and feels stiff. Any tips for making it more responsive? I\'ve tried different wire gauges but still not getting the results I want.'
                : 'Just completed this set of vintage wire cars inspired by 1950s American classics. Each took about 40 hours to complete! I focused on getting the chrome details right and making sure the proportions were accurate to the real vehicles.'
        };

        const mockPosts = [
            {
                id: 1,
                user_name: 'Thomas B.',
                content: threadId === '1' 
                    ? 'Try using a thinner gauge wire for the steering column and add a small washer at the pivot point. That worked for me when I had similar issues.'
                    : 'Amazing work! The attention to detail is incredible. I particularly love the grille on the Cadillac replica.',
                created_at: new Date(Date.now() - 90 * 60 * 1000).toISOString(),
                images: []
            },
            {
                id: 2,
                user_name: 'Maria C.',
                content: threadId === '1' 
                    ? 'Make sure you\'re using lubricant on the moving parts. A tiny bit of graphite powder can make a big difference in smoothness.'
                    : 'The proportions are perfect! How did you get the wheel arches so symmetrical?',
                created_at: new Date(Date.now() - 60 * 60 * 1000).toISOString(),
                images: []
            }
        ];

        // Load thread and posts
        async function loadThread() {
            try {
                // In production:
                // const [thread, posts] = await Promise.all([
                //     forumAPI.getThreadById(threadId),
                //     forumAPI.getPostsByThread(threadId)
                // ]);

                // For demo:
                const thread = mockThread;
                const posts = mockPosts;

                // Display thread header
                document.getElementById('thread-header').innerHTML = `
                    <div class="flex items-center gap-2 mb-4">
                        <span class="px-3 py-1 text-sm font-semibold rounded ${categoryBadges[thread.category]}">${thread.category.replace('-', ' ').toUpperCase()}</span>
                        <span class="text-sm text-gray-500">${formatDate(thread.created_at)}</span>
                    </div>
                    <h1 class="text-3xl font-bold text-gray-900 mb-4">${thread.title}</h1>
                    <div class="flex items-center text-gray-600">
                        <i class="fas fa-user mr-2"></i>
                        <span>Started by <strong>${thread.user_name}</strong></span>
                        <span class="mx-2">â€¢</span>
                        <i class="fas fa-comment mr-2"></i>
                        <span>${posts.length} ${posts.length === 1 ? 'reply' : 'replies'}</span>
                    </div>
                    <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                        <p class="text-gray-700">${thread.content}</p>
                    </div>
                `;

                // Display posts
                const postsDiv = document.getElementById('posts-list');
                if (posts.length === 0) {
                    postsDiv.innerHTML = '<div class="bg-white rounded-lg p-8 text-center text-gray-600">No replies yet. Be the first to reply!</div>';
                } else {
                    postsDiv.innerHTML = posts.map(post => `
                        <div class="bg-white rounded-lg shadow p-6 transform hover:-translate-y-1 transition duration-300">
                            <div class="flex items-start gap-4">
                                <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center flex-shrink-0">
                                    <i class="fas fa-user text-purple-600"></i>
                                </div>
                                <div class="flex-1">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="font-bold text-gray-900">${post.user_name}</span>
                                        <span class="text-sm text-gray-500">${formatDate(post.created_at)}</span>
                                    </div>
                                    <div class="prose prose-sm max-w-none text-gray-700">
                                        ${post.content}
                                    </div>
                                    ${post.images && post.images.length > 0 ? `
                                        <div class="grid grid-cols-2 gap-2 mt-4">
                                            ${post.images.map(img => `
                                                <img src="${img}" alt="Attachment" class="rounded-lg">
                                            `).join('')}
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    `).join('');
                }

            } catch (error) {
                console.error('Error loading thread:', error);
                document.getElementById('thread-header').innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-exclamation-circle text-4xl text-red-600 mb-4"></i>
                        <p class="text-gray-600">Failed to load discussion</p>
                        <a href="forum.html" class="text-purple-600 hover:text-purple-800 mt-4 inline-block">Back to Forum</a>
                    </div>
                `;
            }
        }

        // Submit reply
        document.getElementById('reply-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const messageDiv = document.getElementById('reply-message');

            const postData = {
                thread_id: threadId,
                user_name: document.getElementById('reply-username').value,
                content: document.getElementById('reply-content').value
            };

            try {
                // In production: await forumAPI.createPost(postData);
                
                // For demo: add to mock posts
                const newPost = {
                    id: mockPosts.length + 1,
                    ...postData,
                    created_at: new Date().toISOString(),
                    images: []
                };
                
                mockPosts.push(newPost);
                
                messageDiv.innerHTML = '<p class="text-green-600 font-medium">Reply posted successfully!</p>';
                document.getElementById('reply-form').reset();
                
                // Reload posts after a short delay
                setTimeout(() => {
                    loadThread();
                    messageDiv.innerHTML = '';
                    // Scroll to new post
                    window.scrollTo({
                        top: document.body.scrollHeight,
                        behavior: 'smooth'
                    });
                }, 1000);
            } catch (error) {
                console.error('Error posting reply:', error);
                messageDiv.innerHTML = '<p class="text-red-600">Failed to post reply. Please try again.</p>';
            }
        });

        // Format date
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
            return new Date(dateString).toLocaleDateString('en-US', options);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadThread();
        });
    </script>
</body>
</html>